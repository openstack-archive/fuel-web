"""fuel_5_1

Revision ID: 1398619bdf8c
Revises: 1a1504d469f8
Create Date: 2014-05-30 14:46:55.496697

"""

# revision identifiers, used by Alembic.
revision = '1398619bdf8c'
down_revision = '1a1504d469f8'

from alembic import op
import sqlalchemy as sa

from nailgun import consts
from nailgun.db.sqlalchemy.models.fields import JSON


def upgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.add_column('releases',
                  sa.Column('can_update_versions', JSON(), nullable=False))
    op.add_column('clusters',
                  sa.Column('pending_release_id', sa.Integer(), nullable=True))
    op.create_foreign_key('fk_pending_release_id',
                          'clusters',
                          'releases',
                          ['pending_release_id'],
                          ['id'], )
    op.alter_column('clusters',
                    'status',
                    type_=sa.Enum(*consts.CLUSTER_STATUSES,
                                  name='cluster_status'),
                    nullable=False)
    op.alter_column('tasks',
                    'name',
                    type_=sa.Enum(*consts.TASK_NAMES,
                                  name='task_name'),
                    nullable=False)
    ### end Alembic commands ###


def downgrade():
    ### commands auto generated by Alembic - please adjust! ###
    op.alter_column('tasks',
                    'name',
                    type_=sa.Enum('super', 'deploy', 'deployment',
                                  'provision', 'stop_deployment',
                                  'reset_environment',
                                  'node_deletion',
                                  'cluster_deletion',
                                  'check_before_deployment',
                                  'check_networks',
                                  'verify_networks', 'check_dhcp',
                                  'verify_network_connectivity',
                                  'redhat_setup',
                                  'redhat_check_credentials',
                                  'redhat_check_licenses',
                                  'redhat_download_release',
                                  'redhat_update_cobbler_profile',
                                  'dump', 'capacity_log',
                                  name='task_name'),
                    nullable=False)
    op.alter_column('clusters',
                    'status',
                    type_=sa.Enum('new', 'deployment', 'stopped',
                                  'operational', 'error', 'remove',
                                  name='cluster_status'),
                    nullable=False)
    op.drop_constraint('pending_release_id',
                       'clusters',
                       type_='foreignkey')
    op.drop_column('clusters', 'pending_release_id')
    op.drop_column('releases', 'can_update_versions')
    ### end Alembic commands ###
